# app120 — 120 Dakikalık Analiz Platformu

## Genel Bakış
- 120 dakikalık mumları analiz eden ana paket; sequence sayımı, DC analizi ve IOU/IOV sinyal taraması tek arayüzde birleşir.
- Web sunucusu varsayılan olarak port 2120’de çalışır ve altı sekmeli bir arayüz sunar.
- Kaynak verinin `UTC-4` veya `UTC-5` olabileceği varsayılır; `UTC-5` yüklemeleri otomatik olarak +60 dk kaydırılır.

## Modül Yapısı
- `counter.py`: CSV yükleme, DC hesaplama, offset dizileri, IOV/IOU sinyal motoru ve tahmin üretimi.
- `main.py`: 60 dakikalık veriden 120 dakikalık bloklar oluşturan dönüştürücü.
- `web.py`: Analiz, DC listesi, offset matrisi, IOV/IOU taramaları ve 60→120 dönüştürücüyü tek arayüzde birleştirir.

## Web Sekmeleri
1. **Analiz:** Sequence adımlarına göre zaman çizelgesi, DC durumu, OC/PrevOC ve tahmin edilen slotları listeler. `show_dc` seçeneği DC satırlarını görünür kılar.
2. **DC List:** Tüm DC mumlarının ham OHLC değerlerini, etkilenen sequence indeksleriyle birlikte verir.
3. **Matrix:** `-3..+3` offsetlerinin tamamını tek tabloda zaman damgası, OC, PrevOC şeklinde özetler. Tahmini slotlar `pred` etiketiyle işaretlenir.
4. **IOV Tarama:** Zıt işaretli OC/PrevOC ikililerini limit ve ± tolerans eşiğine göre raporlar. Varsayılan tolerans 0.005’tir; kullanıcı dilerse değiştirir. S1 için `1` ve `3`, S2 için `1` ve `5` indeksleri sinyal dışıdır.
5. **IOU Tarama:** Aynı işaretli OC/PrevOC ikililerine odaklanır; limit + tolerans eşiği karşılanmadığında satırlar filtrelenir.
6. **60→120 Converter:** 60m CSV’yi bloklayıp 120m çıktısı üretir; dosya indirme linki sağlar.

Tüm tarama sekmeleri aynı anda birden fazla CSV dosyasını kabul eder. Formdaki sequence, limit, tolerans ve timezone ayarları her dosyaya aynı şekilde uygulanır; sonuçlar dosya kartları halinde gösterilir.

## Distorted Candle ve Offset Kuralları
- DC istisnaları: 18:00 DC değildir; (Pazar hariç) 20:00 DC değildir; Cuma 16:00 DC sayılmaz (hafta kapanışı kontrolü). Ardışık DC engeli aktiftir.
- Pozitif offsette DC’ye denk gelen adımlar otomatik olarak bir sonraki gerçek muma kaydırılır; +1/+2/+3 için başlangıç DC ise geçici olarak normal mum gibi ele alınır.
- Tahmini slotlar yalnızca veri dışına taşıldığında üretilir ve `pred` etiketiyle görünür.

## IOU/IOV Limit & Tolerans Mantığı
- Kullanıcı limit alanına pozitif veya negatif değer girebilir; sistem `abs(limit)` kullanır.
- Sonuçların listelenmesi için hem `|OC|` hem `|PrevOC|` değerlerinin `limit + tolerans` eşiğini geçmesi gerekir.
- Tolerans değeri her dosya için aynı form alanından okunur; boş bırakılırsa varsayılan 0.005 kullanılır.

## IOU Kısıtları ve Akışı
- IOU’da 16:00 ve 18:00 tüm günlerde, 20:00 tüm günlerde ve ayrıca tüm Pazar mumları elenir.
- IOU formu iki aşamalıdır: ilk adımda dosyalar için Joker seçimi yapılır; ikinci adımda sonuçlar aynı sayfada “Analiz #...“ bloklarıyla üst üste (“stacked”) birikir.
- Web’de XYZ filtresi `|OC| > eşik` veya `|PrevOC| > eşik` kuralıyla (OR ve `>`) çalışır; çekirdek kural `AND` ve `≥`’dir.

## XYZ Filtresi ve Haber Entegrasyonu
- IOU sekmesinde “XYZ kümesi (haber filtreli)” kutucuğu işaretlenirse haber desteği olmayan offsetler elenir; yalnızca etkili haberi bulunan (normal/speech) hit’ler kümede kalır.
- `news_loader.py` haberleri JSON takvim dosyalarından çekip `Var`, `Holiday`, `Yok` etiketleriyle sunar.
- Tatil başlığı içeren satırlar bilgi amaçlıdır; haber sayılmadıkları için bulundukları offsetler XYZ kümesinin dışında kalır.
- Haber bulunmayan offsetler filtre etkin olduğunda listeden çıkarılır.

## Veri Beklentileri ve Notlar
- Sequence dizileri S1 ve S2 desteklenir; 18:00 baz mumu normalizasyonu tüm hesaplamaların temelidir.
- CSV başlıkları esnek; `Close (Last)` vb. varyantlar otomatik algılanır.
- Büyük CSV yüklemelerinde (50 dosyaya kadar, 50 MB toplam limit) tarayıcı sınırlarına dikkat edilmelidir; sistem dosyaları tek tek işleyip kartlarda özetler.
